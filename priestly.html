<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Overlay with Upload and Download</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Trirong">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      color: white;
    }

    .holder {
      background: black;
    }

    .container {
      padding: 1rem;
      text-align: center;
    }

    input[type="file"] {
      display: none;
    }

    .upload-label, .download-btn {
      padding: 0.5rem 1rem;
      background: #222;
      color: white;
      border: 1px solid #444;
      border-radius: 6px;
      cursor: pointer;
      margin: 0.5rem;
      display: inline-block;
    }

    .countdown-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .countdown-box {
      background-color: #EA8417;
      color: white;
      font-size: 1.5rem;
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      flex-direction: column;
      box-shadow: 0 0 8px rgba(255, 105, 180, 0.7);
    }

    .countdown-label {
      font-size: 0.8rem;
      margin-top: 4px;
    }

    .image-wrapper {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    .image-wrapper::before {
      content: '';
      display: block;
      padding-top: 130%;
    }

    .background-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-overlay {
      position: absolute;
      top: 43.5%;
      left: 6.0%;
      border-radius: 7px;
      width: 39.45%;
      aspect-ratio: 4 / 4.7;
      border: 4px solid #FF6D0D;
      box-shadow: 0 0 10px rgba(255,255,0,0.4);
      background: #000;
      overflow: hidden;
    }

    .photo-inner {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .photo-inner img {
      position: absolute;
      max-width: none;
      max-height: none;
      display: none;
      user-select: none;
      cursor: grab;
    }

    .placeholder-text {
      color: #aaa;
      font-size: 0.9rem;
      text-align: center;
      position: absolute;
      width: 100%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    @media (max-width: 600px) {
      .photo-overlay {
        border-width: 2px;
      }
      .countdown-box {
        width: 60px;
        height: 60px;
        font-size: 1.1rem;
      }
    }

    .head {
      background-color: #08012e;
    }
    .com{
      border: 1px black solid;
      background-color: none;
      border-left: none;
      border-right: none;
    }
.chat-bubble {
  border: none;            /* Remove borders */
  outline: none;           /* Just in case it's an outline */
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08); /* Soft shadow for depth */
  background-color: #f2f6ff;
  border-radius: 12px;
  padding: 0.75rem 1rem;
  margin-bottom: 1rem;
  max-width: 600px;
}
.chat-bubble:hover {
  transform: translateY(-2px);
}

.chat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.4rem;
  font-size: 0.85rem;
  color: #555;
}

.chat-author {
  font-weight: 600;
  color: #0056b3;
}

.chat-time {
  font-size: 0.75rem;
  color: #999;
  font-style: italic;
}

.chat-message {
  margin: 0;
  font-size: 1rem;
  color: #333;
  line-height: 1.4;
}
.chat-time {
  font-size: 0.75rem;
  color: #999;
  font-style: italic;
  text-align: right;
  margin-top: 0.5rem;
}
  </style>
</head>
<body>
  <header class="head text-white py-3 mb-5">
    <div class="container">
      <h1 class="h3 mb-0 text-center text-uppercase">Edifice International Network</h1>
    </div>
  </header>
  <h2 style="text-align: center; color: black;" class="display-5 mb-4 text-primary">COME AND EXPERIENCE GLORYðŸ”¥ðŸ”¥</h2>
  <div class="d-flex justify-content-center">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden col-lg-12" style="max-width: 600px;">
      <img src="sing.jpg" class="card-img-top" alt="Worship Experience Image" />
      <div class="card-body p-4">
        <h5 class="card-title text-uppercase text-primary fw-bold mb-3">Worship Experience</h5>
        <p class="card-text fs-5">
          <strong>Priesthood</strong> is a divine technology in God by which mortals interface with the invisible through offerings and sacrifices.
        </p>
        <p class="card-text fs-5">
          We approach the court with the sounds of our priesthood.<br />
          We map the city by the instrumentality of our incense.
        </p>
        <p class="fst-italic text-muted mb-4">"WORSHIP EXPERIENCE"<br />(Priestly sounds)</p>
        <p class="card-text fs-5">
          In and around <strong>Otukpo</strong>, Join us as we experience heaven on earth by the agency of sounds.
        </p>
        <div class="text-muted small">
          @min_adama_samuel_godfrey <br />
          @Edifice_international_network <br />
          @worshipexperience2025 <br />
          @priestlysounds <br />
          @ReviveUs
        </div>
      </div>
    </div>
  </div>

  <h5 class="display-5 text-black mb-5 mt-5" style="text-align: center;">FEW HOURS TO GO</h5>

  <div class="holder col-10 mx-auto w-100 mb-0">
    <div class="container">

      <div class="countdown-container" id="countdown">
  <div class="countdown-box">
    <span id="hours">00</span>
    <div class="countdown-label">hours</div>
  </div>
  <div class="countdown-separator">:</div>
  <div class="countdown-box">
    <span id="minutes">00</span>
    <div class="countdown-label">min</div>
  </div>
  <div class="countdown-separator">:</div>
  <div class="countdown-box">
    <span id="seconds">00</span>
    <div class="countdown-label">sec</div>
  </div>
</div>

      <br /><br />

      <div id="flyer" class="image-wrapper col-sm-6 col-md-10 col-lg-10">
        <img src="light.jpg" alt="Flyer Background" class="background-image" id="flyer-bg" />
        <div class="photo-overlay" id="overlay">
          <div class="photo-inner">
            <div class="placeholder-text" id="placeholder">Your photo will appear here</div>
            <img id="person-img" alt="Uploaded Person" />
          </div>
        </div>
      </div>

      <br /><br />

      <label for="upload" class="upload-label">Choose your photo</label>
      <input type="file" id="upload" accept="image/*" />
      <button class="download-btn" onclick="downloadFlyer(false)">Download Flyer</button>
    </div>
  </div>

  <div class="container mt-0 col-lg-10">
    <h2>Contact Form</h2>
    <form class="col-lg-10 mx-auto d-block" method="POST" action="{% url 'submit_comment' %}">
      {% csrf_token %}
      <div class="mb-0">
        <label for="firstName" class="form-label">First Name</label>
        <input type="text" class="form-control" name="firstName" placeholder="Enter your first name" />
      </div>
      <div class="mb-0">
        <label for="lastName" class="form-label">Last Name</label>
        <input type="text" class="form-control" name="lastName" placeholder="Enter your last name" />
      </div>
      <div class="mb-3">
        <label for="comment" class="form-label">Comment</label>
        <textarea class="form-control" name="comment" rows="4" placeholder="Write your comment here"></textarea>
      </div>
      <!-- Hidden timestamp input to save submission time -->
      <input type="hidden" name="timestamp" id="timestamp" />
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>
  </div>

  <div class="container mt-4 col-sm-6 col-md-10 col-lg-10 container">
    <h2 class="mb-4">User Comments</h2>
    <h1 class="display-6 mb-3 mx-auto text-primary">COMMENTS</h1>
    <!-- JS will dynamically populate comments here -->
  </div>

  <script>
    const uploadInput = document.getElementById('upload');
    const personImg = document.getElementById('person-img');
    const placeholder = document.getElementById('placeholder');

    let offsetX, offsetY, isDragging = false;

    function disableScroll() {
      document.body.style.overflow = 'hidden';
    }

    function enableScroll() {
      document.body.style.overflow = '';
    }

    uploadInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const tempImg = new Image();
          tempImg.onload = function() {
            const container = document.querySelector('.photo-inner');
            const containerRatio = container.offsetWidth / container.offsetHeight;
            const imgRatio = tempImg.width / tempImg.height;

            personImg.style.left = '0px';
            personImg.style.top = '0px';

            if (imgRatio > containerRatio) {
              personImg.style.height = '120%';
              personImg.style.width = 'auto';
            } else {
              personImg.style.width = '120%';
              personImg.style.height = 'auto';
            }

            personImg.src = e.target.result;
            personImg.style.display = 'block';
            placeholder.style.display = 'none';
          };
          tempImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    personImg.addEventListener('mousedown', function(e) {
      isDragging = true;
      const rect = personImg.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      personImg.style.cursor = 'grabbing';
      disableScroll();
    });

    document.addEventListener('mousemove', function(e) {
      if (!isDragging) return;
      const overlayRect = document.querySelector('.photo-inner').getBoundingClientRect();
      const newX = e.clientX - overlayRect.left - offsetX;
      const newY = e.clientY - overlayRect.top - offsetY;
      personImg.style.left = `${newX}px`;
      personImg.style.top = `${newY}px`;
    });

    document.addEventListener('mouseup', function() {
      isDragging = false;
      personImg.style.cursor = 'grab';
      enableScroll();
    });

    personImg.addEventListener('touchstart', function(e) {
      isDragging = true;
      const rect = personImg.getBoundingClientRect();
      const touch = e.touches[0];
      offsetX = touch.clientX - rect.left;
      offsetY = touch.clientY - rect.top;
      disableScroll();
    });

    document.addEventListener(
      'touchmove',
      function(e) {
        if (!isDragging) return;
        e.preventDefault(); // prevent page scrolling
        const overlayRect = document.querySelector('.photo-inner').getBoundingClientRect();
        const touch = e.touches[0];
        const newX = touch.clientX - overlayRect.left - offsetX;
        const newY = touch.clientY - overlayRect.top - offsetY;
        personImg.style.left = `${newX}px`;
        personImg.style.top = `${newY}px`;
      },
      { passive: false }
    );

    document.addEventListener('touchend', function() {
      isDragging = false;
      enableScroll();
    });

    function downloadFlyer(force = false) {
      const flyerElement = document.getElementById('flyer');
      const allImages = flyerElement.querySelectorAll('img');

      const runCapture = () => {
        html2canvas(flyerElement, {
          useCORS: true,
          backgroundColor: null,
          scale: 2,
          width: flyerElement.offsetWidth,
          height: flyerElement.offsetHeight,
        }).then((canvas) => {
          canvas.toBlob((blob) => {
            const link = document.createElement('a');
            link.download = 'my-flyer.png';
            link.href = URL.createObjectURL(blob);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          });
        });
      };

      Promise.all(
        Array.from(allImages).map(
          (img) => new Promise((resolve) => (img.complete ? resolve() : (img.onload = resolve)))
        )
      ).then(runCapture);
    }

    function updateCountdown() {
      const targetDate = new Date(2025, 6, 6, 15, 0, 0);
 
      const now = new Date();
      const diff = targetDate - now;

      if (diff <= 0) {
        document.getElementById('countdown').innerHTML =
          '<div class="countdown-box">00<div class="countdown-label">Done</div></div>';
        return;
      }

      const totalSeconds = Math.floor(diff / 1000);
      const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
      const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
      const seconds = String(totalSeconds % 60).padStart(2, '0');

      document.getElementById('hours').textContent = hours;
      document.getElementById('minutes').textContent = minutes;
      document.getElementById('seconds').textContent = seconds;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();

    // ======= Comments section JS =======

    const commentForm = document.querySelector('form[method="POST"]');
    const commentsContainer = document.querySelector('.container.mt-4.col-sm-6.col-md-10.col-lg-10.container');
    const commentsListTitle = commentsContainer.querySelector('h1.display-6');
    const commentsList = document.createElement('div');
    commentsList.className = 'comments-list';
    commentsContainer.appendChild(commentsList);

    // Load comments from localStorage on page load
    function loadComments() {
      const comments = JSON.parse(localStorage.getItem('comments')) || [];
      commentsList.innerHTML = '';

      if (comments.length === 0) {
        commentsList.innerHTML = '<p class="text-muted">No comments available.</p>';
        return;
      }

      comments.forEach(({ firstName, lastName, comment, timestamp }) => {
        const card = document.createElement('div');
        card.className = 'card mb-3';
        const timeString = new Date(timestamp).toLocaleString('en-US', {
  month: 'short',
  day: 'numeric',
  hour: 'numeric',
  minute: '2-digit',
  hour12: true,
});
    card.innerHTML = `
<div class="comment-bubble">
  <div class="comment-header">
    <span class="comment-author ">${firstName.toUpperCase()} ${lastName.toUpperCase()}</span>&nbsp;&nbsp;
    <span class="comment-time">${timeString}</span>
  </div>
  <p class="comment-text text-primary">${comment}</p>
</div>
        `;
        commentsList.appendChild(card);
      });
    }

    // Save a new comment to localStorage
    function saveComment(firstName, lastName, comment, timestamp) {
      const comments = JSON.parse(localStorage.getItem('comments')) || [];
      comments.unshift({ firstName, lastName, comment, timestamp });
      localStorage.setItem('comments', JSON.stringify(comments));
    }

    // Update hidden timestamp field before submit
    commentForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(commentForm);
      const firstName = formData.get('firstName').trim();
      const lastName = formData.get('lastName').trim();
      const comment = formData.get('comment').trim();

      if (!firstName || !lastName || !comment) {
        alert('Please fill all fields!');
        return;
      }

      const nowISO = new Date().toISOString();
      document.getElementById('timestamp').value = nowISO;

      // Save to localStorage
      saveComment(firstName, lastName, comment, nowISO);

      // Reload comments list
      loadComments();

      // Reset form fields
      commentForm.reset();
    });

    // Load comments when page loads
    loadComments();
  </script>
</body>
</html>
